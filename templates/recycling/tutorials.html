{% extends 'recycling/base.html' %}

{% block title %}卡券教程 - 卡券回收平台{% endblock %}

{% block extra_css %}
<style>
.tutorial-card {
    transition: all 0.3s ease;
    border: 1px solid #dee2e6;
    border-radius: 12px;
    overflow: hidden;
    margin-bottom: 1rem;
}

.tutorial-card:hover {
    transform: translateY(-2px);
    box-shadow: 0 4px 12px rgba(0, 0, 0, 0.15);
    border-color: #007bff;
}

.tutorial-card:active {
    transform: translateY(0);
    box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1);
}

.tutorial-card .card-title {
    color: #333;
    transition: color 0.3s ease;
}

.tutorial-card:hover .card-title {
    color: #007bff;
}

.tutorial-card .card-body {
    position: relative;
}

.tutorial-card:hover .card-body::after {
    content: '\f105';
    font-family: 'Font Awesome 6 Free';
    font-weight: 900;
    position: absolute;
    right: 1rem;
    top: 50%;
    transform: translateY(-50%);
    color: #007bff;
    opacity: 0.7;
    animation: slideIn 0.3s ease;
}

/* 移动端教程页面优化 */
@media (max-width: 768px) {
    .tutorial-card {
        border-radius: 8px;
        margin-bottom: 0.75rem;
    }
    
    .tutorial-card .card-body {
        padding: 1rem;
    }
    
    .tutorial-card .card-title {
        font-size: 1rem;
        line-height: 1.4;
    }
    
    .tutorial-card .card-text {
        font-size: 0.9rem;
        line-height: 1.5;
    }
    
    /* 移动端取消hover效果，优化点击体验 */
    .tutorial-card:hover {
        transform: none;
        box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1);
    }
    
    .tutorial-card:hover .card-body::after {
        display: none;
    }
    
    /* 添加点击态反馈 */
    .tutorial-card:active {
        transform: scale(0.98);
        transition: transform 0.1s ease;
    }
    
    /* 教程元信息优化 */
    .tutorial-meta {
        font-size: 0.8rem;
    }
    
    .tutorial-meta .badge {
        font-size: 0.7rem;
        padding: 0.25em 0.5em;
    }
}

@media (max-width: 576px) {
    .tutorial-card {
        margin: 0.5rem;
        border-radius: 0.75rem;
    }
    
    .tutorial-card .card-body {
        padding: 0.875rem;
    }
    
    .tutorial-card .card-title {
        font-size: 0.95rem;
    }
    
    .tutorial-card .card-text {
        font-size: 0.85rem;
        margin-bottom: 0.75rem;
    }
}

/* 减少动画提高性能 */
@media (prefers-reduced-motion: reduce) {
    .tutorial-card {
        transition: none;
    }
    
    .tutorial-card:hover .card-body::after {
        animation: none;
    }
}

/* 触摸设备优化 */
@media (hover: none) and (pointer: coarse) {
    .tutorial-card {
        -webkit-tap-highlight-color: rgba(0, 123, 255, 0.1);
    }
    
    .tutorial-card:hover {
        transform: none;
        box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1);
        border-color: #dee2e6;
    }
    
    .tutorial-card:hover .card-title {
        color: #333;
    }
    
    .tutorial-card:hover .card-body::after {
        display: none;
    }
}

@keyframes slideIn {
    from {
        opacity: 0;
        transform: translateY(-50%) translateX(-10px);
    }
    to {
        opacity: 0.7;
        transform: translateY(-50%) translateX(0);
    }
}
</style>
{% endblock %}

{% block content %}
<div class="container-fluid">
    <!-- 页面标题 -->
    <div class="row mb-4">
        <div class="col-12">
            <div class="d-flex align-items-center">
                <i class="fas fa-graduation-cap text-primary me-3 fa-2x"></i>
                <div>
                    <h2 class="mb-1">卡券教程</h2>
                    <p class="text-muted mb-0">学习卡券回收的技巧和方法</p>
                </div>
            </div>
        </div>
    </div>
    
    <!-- 筛选器 -->
    <div class="row mb-4">
        <div class="col-12">
            <div class="card">
                <div class="card-body">
                    <div class="row align-items-center">
                        <div class="col-md-8">
                            <div class="d-flex align-items-center">
                                <label for="categoryFilter" class="form-label mb-0 me-3 fw-bold">
                                    <i class="fas fa-filter me-1"></i>筛选类别：
                                </label>
                                <select class="form-select" id="categoryFilter" style="width: auto;">
                                    <option value="">全部类别</option>
                                    {% for category in categories %}
                                    <option value="{{ category.id }}">{{ category.name }}</option>
                                    {% endfor %}
                                </select>
                            </div>
                        </div>
                        <div class="col-md-4 text-end">
                            <div class="text-muted">
                                <i class="fas fa-book me-1"></i>
                                共 <span id="tutorialCount">{{ tutorials_count }}</span> 篇教程
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
    
    <!-- 推荐教程 -->
    {% if featured_tutorials %}
    <div class="row mb-4">
        <div class="col-12">
            <h4 class="mb-3">
                <i class="fas fa-star text-warning me-2"></i>推荐教程
            </h4>
            <div class="row">
                {% for tutorial in featured_tutorials %}
                <div class="col-md-6 col-lg-4 mb-4">
                    <div class="card h-100 border-warning">
                        <div class="position-relative">
                            {% if tutorial.cover_image %}
                            <img src="{{ tutorial.cover_image }}" class="card-img-top" alt="{{ tutorial.title }}" style="height: 200px; object-fit: cover;">
                            {% else %}
                            <div class="card-img-top bg-gradient-warning d-flex align-items-center justify-content-center" style="height: 200px;">
                                <i class="fas fa-image fa-3x text-white opacity-50"></i>
                            </div>
                            {% endif %}
                            <span class="position-absolute top-0 start-0 badge bg-warning text-dark m-2">
                                <i class="fas fa-star me-1"></i>推荐
                            </span>
                        </div>
                        <div class="card-body d-flex flex-column">
                            <div class="mb-2">
                                <span class="badge bg-primary">{{ tutorial.category.name }}</span>
                            </div>
                            <h5 class="card-title">{{ tutorial.title }}</h5>
                            <p class="card-text text-muted flex-grow-1">{{ tutorial.summary }}</p>
                            <div class="d-flex justify-content-between align-items-center mt-auto">
                                <small class="text-muted">
                                    <i class="fas fa-eye me-1"></i>{{ tutorial.views }} 浏览
                                </small>
                                <a href="{% url 'tutorial_detail' tutorial.id %}" class="btn btn-outline-warning btn-sm">
                                    阅读教程 <i class="fas fa-arrow-right ms-1"></i>
                                </a>
                            </div>
                        </div>
                    </div>
                </div>
                {% endfor %}
            </div>
        </div>
    </div>
    {% endif %}
    
    <!-- 所有教程 -->
    <div class="row">
        <div class="col-12">
            <h4 class="mb-3">
                <i class="fas fa-list me-2"></i>全部教程
            </h4>
            <div id="tutorialsList">
                {% if tutorials %}
                {% for tutorial in tutorials %}
                <div class="tutorial-item" data-category="{{ tutorial.category.id }}">
                    <div class="card tutorial-card" data-url="{% url 'tutorial_detail' tutorial.id %}" style="cursor: pointer;">
                        <div class="row g-0">
                            <div class="col-md-3">
                                <div class="position-relative h-100">
                                    {% if tutorial.cover_image %}
                                    <img src="{{ tutorial.cover_image }}" class="img-fluid rounded-start h-100" alt="{{ tutorial.title }}" style="object-fit: cover; min-height: 150px;">
                                    {% else %}
                                    <div class="bg-light d-flex align-items-center justify-content-center rounded-start h-100" style="min-height: 150px;">
                                        <i class="fas fa-image fa-2x text-muted"></i>
                                    </div>
                                    {% endif %}
                                    <span class="position-absolute top-0 end-0 badge bg-secondary m-2">
                                        {{ tutorial.published_at|date:"M d" }}
                                    </span>
                                </div>
                            </div>
                            <div class="col-md-9">
                                <div class="card-body h-100 d-flex flex-column">
                                    <div class="d-flex align-items-start justify-content-between mb-2">
                                        <span class="badge bg-primary">{{ tutorial.category.name }}</span>
                                        <small class="text-muted">
                                            <i class="fas fa-eye me-1"></i>{{ tutorial.views }} 浏览
                                        </small>
                                    </div>
                                    <h5 class="card-title mb-2">{{ tutorial.title }}</h5>
                                    <p class="card-text text-muted flex-grow-1 mb-3">{{ tutorial.summary|truncatechars:120 }}</p>
                                    <div class="d-flex justify-content-end align-items-center">
                                        <small class="text-muted">
                                            <i class="fas fa-calendar me-1"></i>{{ tutorial.published_at|date:"Y年m月d日" }}
                                        </small>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
                {% endfor %}
                
                <!-- 分页导航 -->
                {% if tutorials.has_other_pages %}
                <div class="d-flex justify-content-center mt-4">
                    <nav aria-label="教程分页">
                        <ul class="pagination">
                            {% if tutorials.has_previous %}
                            <li class="page-item">
                                <a class="page-link" href="?page={{ tutorials.previous_page_number }}" aria-label="上一页">
                                    <span aria-hidden="true">&laquo;</span>
                                </a>
                            </li>
                            {% else %}
                            <li class="page-item disabled">
                                <span class="page-link" aria-label="上一页">
                                    <span aria-hidden="true">&laquo;</span>
                                </span>
                            </li>
                            {% endif %}
                            
                            {% for num in tutorials.paginator.page_range %}
                            {% if tutorials.number == num %}
                            <li class="page-item active">
                                <span class="page-link">{{ num }}</span>
                            </li>
                            {% elif num > tutorials.number|add:'-3' and num < tutorials.number|add:'3' %}
                            <li class="page-item">
                                <a class="page-link" href="?page={{ num }}">{{ num }}</a>
                            </li>
                            {% elif num == 1 %}
                            <li class="page-item">
                                <a class="page-link" href="?page=1">1</a>
                            </li>
                            {% if tutorials.number > 4 %}
                            <li class="page-item disabled">
                                <span class="page-link">...</span>
                            </li>
                            {% endif %}
                            {% elif num == tutorials.paginator.num_pages %}
                            {% if tutorials.number < tutorials.paginator.num_pages|add:'-3' %}
                            <li class="page-item disabled">
                                <span class="page-link">...</span>
                            </li>
                            {% endif %}
                            <li class="page-item">
                                <a class="page-link" href="?page={{ tutorials.paginator.num_pages }}">{{ tutorials.paginator.num_pages }}</a>
                            </li>
                            {% endif %}
                            {% endfor %}
                            
                            {% if tutorials.has_next %}
                            <li class="page-item">
                                <a class="page-link" href="?page={{ tutorials.next_page_number }}" aria-label="下一页">
                                    <span aria-hidden="true">&raquo;</span>
                                </a>
                            </li>
                            {% else %}
                            <li class="page-item disabled">
                                <span class="page-link" aria-label="下一页">
                                    <span aria-hidden="true">&raquo;</span>
                                </span>
                            </li>
                            {% endif %}
                        </ul>
                    </nav>
                </div>
                
                <!-- 分页信息 -->
                <div class="text-center mt-2">
                    <small class="text-muted">
                        显示第 {{ tutorials.start_index }} - {{ tutorials.end_index }} 条，共 {{ tutorials.paginator.count }} 条教程
                        （第 {{ tutorials.number }} 页，共 {{ tutorials.paginator.num_pages }} 页）
                    </small>
                </div>
                {% endif %}
                
                {% else %}
                <div class="text-center py-5">
                    <i class="fas fa-book-open fa-3x text-muted mb-3"></i>
                    <h5 class="text-muted">暂无教程</h5>
                    <p class="text-muted">敬请期待更多精彩教程</p>
                </div>
                {% endif %}
            </div>
        </div>
    </div>
</div>
{% endblock %}

{% block extra_js %}
<script>
$(document).ready(function() {
    // 教程卡片点击功能
    $('.tutorial-card').on('click', function() {
        const url = $(this).data('url');
        if (url) {
            window.location.href = url;
        }
    });
    
    // 类别筛选功能
    $('#categoryFilter').on('change', function() {
        const selectedCategory = $(this).val();
        let visibleCount = 0;
        
        $('.tutorial-item').each(function() {
            const tutorialCategory = $(this).data('category');
            
            if (selectedCategory === '' || tutorialCategory == selectedCategory) {
                $(this).show();
                visibleCount++;
            } else {
                $(this).hide();
            }
        });
        
        // 更新计数
        $('#tutorialCount').text(visibleCount);
        
        // 如果没有匹配的教程，显示提示
        if (visibleCount === 0 && selectedCategory !== '') {
            if ($('#noResultsMessage').length === 0) {
                $('#tutorialsList').append(`
                    <div id="noResultsMessage" class="text-center py-5">
                        <i class="fas fa-search fa-3x text-muted mb-3"></i>
                        <h5 class="text-muted">未找到相关教程</h5>
                        <p class="text-muted">请尝试选择其他类别</p>
                    </div>
                `);
            }
        } else {
            $('#noResultsMessage').remove();
        }
    });
});
</script>
{% endblock %}